# LIQUI MOLY Chatbot - ç³»çµ±æ¶æ§‹æ–‡ä»¶

## 1. æ•´é«”æ¶æ§‹ç¢ºèª

### 1.1 æ˜¯å¦ç‚º RAG æ¶æ§‹ï¼Ÿ âœ… YES

```
RAG = Retrieval-Augmented Generation

ä½ çš„ç³»çµ±å®Œæ•´å¯¦ç¾äº† RAG ä¸‰å¤§æ ¸å¿ƒï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RAG æ¶æ§‹é©—è­‰                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Retrieval (æª¢ç´¢)                                          â”‚
â”‚    â”œâ”€ knowledge-retriever.js - çŸ¥è­˜åº«æª¢ç´¢                    â”‚
â”‚    â”œâ”€ search.js - ç”¢å“è³‡æ–™åº«æœå°‹                             â”‚
â”‚    â””â”€ vehicle-matcher.js - è»Šå‹è¦æ ¼åŒ¹é…                      â”‚
â”‚                                                              â”‚
â”‚ 2. Augmentation (å¢å¼·)                                       â”‚
â”‚    â”œâ”€ prompt-builder.js - å‹•æ…‹ Prompt çµ„åˆ                   â”‚
â”‚    â”œâ”€ agent-prompts.js - Multi-Agent å°ˆç”¨ Prompt             â”‚
â”‚    â””â”€ 13 å€‹çŸ¥è­˜åº« JSON - çµæ§‹åŒ–çŸ¥è­˜                          â”‚
â”‚                                                              â”‚
â”‚ 3. Generation (ç”Ÿæˆ)                                         â”‚
â”‚    â”œâ”€ Gemini API - AI å›è¦†ç”Ÿæˆ                               â”‚
â”‚    â”œâ”€ analyze.js - AI æ„åœ–åˆ†æ                               â”‚
â”‚    â””â”€ response-validator.js - é˜²å¹»è¦ºé©—è­‰                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 LLM çŸ¥è­˜ + çŸ¥è­˜åº« æ··åˆæ‡‰ç”¨ âœ… YES

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                çŸ¥è­˜ä¾†æºå±¤ç´š                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Layer 1: çŸ¥è­˜åº« (Grounding - æ¥åœ°)                           â”‚
â”‚    â”œâ”€ ç”¢å“è³‡æ–™åº« (Wix CMS) - SKUã€åƒ¹æ ¼ã€èªè­‰                 â”‚
â”‚    â”œâ”€ vehicle-specs.json - è»Šå‹èªè­‰å°ç…§                      â”‚
â”‚    â”œâ”€ additive-guide.json - ç—‡ç‹€è§£æ±ºæ–¹æ¡ˆ                     â”‚
â”‚    â””â”€ core-identity.json - å“ç‰Œè¦å‰‡                          â”‚
â”‚                                                              â”‚
â”‚ Layer 2: LLM å…§å»ºçŸ¥è­˜ (Reasoning - æ¨ç†)                     â”‚
â”‚    â”œâ”€ èªè¨€ç†è§£å’Œç¿»è­¯                                         â”‚
â”‚    â”œâ”€ è»Šå‹å¹´ä»½æ¨è«–èªè­‰                                       â”‚
â”‚    â”œâ”€ å°è©±ä¸Šä¸‹æ–‡è¨˜æ†¶                                         â”‚
â”‚    â””â”€ è‡ªç„¶èªè¨€å›è¦†ç”Ÿæˆ                                       â”‚
â”‚                                                              â”‚
â”‚ Layer 3: è¦å‰‡è£œå¼· (Fallback - å‚™æ´)                          â”‚
â”‚    â”œâ”€ intent-keywords.json - æ„åœ–é—œéµå­—                      â”‚
â”‚    â”œâ”€ intent-classifier.js - è¦å‰‡åˆ†é¡                        â”‚
â”‚    â””â”€ enhanceIntentWithRules() - è¦å‰‡å¢å¼·                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Meta ç«¯ vs ç¶²é ç«¯ å®Œæ•´æµç¨‹

### 2.1 Meta ç«¯æµç¨‹ (Facebook Messenger / Instagram)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         META ç«¯å®Œæ•´æµç¨‹                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ç”¨æˆ¶ç™¼é€ Messenger è¨Šæ¯                                                     â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ meta-webhook.js (POST /api/meta-webhook)                    â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  1. è¨Šæ¯å»é‡ (messageId å¿«å–)                                â”‚           â”‚
â”‚  â”‚  2. Echo è¨Šæ¯åµæ¸¬ (ç®¡ç†å“¡å›è¦†è·³é)                            â”‚           â”‚
â”‚  â”‚  3. æ¢å¾© AI é—œéµå­—åµæ¸¬ (å„ªå…ˆæ–¼æš«åœ)                           â”‚           â”‚
â”‚  â”‚  4. æš«åœæª¢æŸ¥ (ç­‰å¾…çœŸäººå®¢æœæ™‚ä¸å›è¦†)                           â”‚           â”‚
â”‚  â”‚  5. é™„ä»¶åµæ¸¬ (åœ–ç‰‡ â†’ è½‰çœŸäºº)                                  â”‚           â”‚
â”‚  â”‚  6. çœŸäººå®¢æœé—œéµå­—åµæ¸¬                                        â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ getConversationHistory() - å¾ Wix CMS å–å¾—å°è©±æ­·å²           â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  â€¢ æŸ¥è©¢ ChatbotConversations è³‡æ–™è¡¨                          â”‚           â”‚
â”‚  â”‚  â€¢ åˆ¤æ–·ã€Œç•¶å¤©ç¬¬ä¸€æ¬¡ã€(lastMessageTime æ¯”å°)                   â”‚           â”‚
â”‚  â”‚  â€¢ æå–å·²çŸ¥è»Šå‹è³‡è¨Š                                          â”‚           â”‚
â”‚  â”‚  â€¢ å°è©±æ­·å²å»é‡                                              â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ POST /api/chat                                               â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  å‚³å…¥åƒæ•¸:                                                    â”‚           â”‚
â”‚  â”‚  â€¢ message: ç”¨æˆ¶è¨Šæ¯                                         â”‚           â”‚
â”‚  â”‚  â€¢ conversationHistory: å°è©±æ­·å² (æœ€å¤š 10 æ¢)                â”‚           â”‚
â”‚  â”‚  â€¢ isFirstResponse: ç•¶å¤©æ˜¯å¦ç¬¬ä¸€æ¬¡                           â”‚           â”‚
â”‚  â”‚  â€¢ useMultiAgent: true (é è¨­å•Ÿç”¨)                            â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ å›è¦†è™•ç†                                                     â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  1. Markdown â†’ ç´”æ–‡å­— (FB/IG ä¸æ”¯æ´)                         â”‚           â”‚
â”‚  â”‚  2. åŠ ä¸Š ğŸ¤– æ©Ÿå™¨äººæ¨™è¨»                                       â”‚           â”‚
â”‚  â”‚  3. åˆ†æ®µç™¼é€ (IG: 800å­—, FB: 1800å­—)                         â”‚           â”‚
â”‚  â”‚  4. æœ€å¾Œä¸€æ®µå¸¶å¿«é€Ÿå›è¦†æŒ‰éˆ•                                    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ saveConversationToWix() - éåŒæ­¥å„²å­˜ (Fire-and-Forget)       â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  â€¢ ä¸é˜»æ“‹ç”¨æˆ¶å›è¦†                                            â”‚           â”‚
â”‚  â”‚  â€¢ å„²å­˜ç”¨æˆ¶è¨Šæ¯ + AI å›è¦†                                    â”‚           â”‚
â”‚  â”‚  â€¢ æ›´æ–° lastMessageTime                                      â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç¶²é ç«¯æµç¨‹ (js/chat.js + Wix Velo)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç¶²é ç«¯å®Œæ•´æµç¨‹                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ç”¨æˆ¶å¡«å¯«è¡¨å–® (å§“å/Email/å•é¡Œ)                                              â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ startSession() - Wix Backend API                            â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  â€¢ å»ºç«‹ chatSessions è¨˜éŒ„                                    â”‚           â”‚
â”‚  â”‚  â€¢ è¿”å› sessionId                                            â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ åˆå§‹åŒ–èŠå¤©ç•Œé¢ (LiquiMolyChatbot é¡åˆ¥)                       â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  â€¢ é¡¯ç¤ºå¿«é€Ÿæ“ä½œæŒ‰éˆ•                                          â”‚           â”‚
â”‚  â”‚  â€¢ å•Ÿå‹• 10 åˆ†é˜é–’ç½®è¨ˆæ™‚å™¨                                    â”‚           â”‚
â”‚  â”‚  â€¢ ç›£è½ç”¨æˆ¶æ´»å‹•                                              â”‚           â”‚
â”‚  â”‚  â€¢ conversationHistory = [] (å‰ç«¯ç®¡ç†)                       â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  ç”¨æˆ¶ç™¼é€è¨Šæ¯                                                                â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ callChatAPI()                                                â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  POST /api/chat                                              â”‚           â”‚
â”‚  â”‚  å‚³å…¥åƒæ•¸:                                                    â”‚           â”‚
â”‚  â”‚  â€¢ message: ç”¨æˆ¶è¨Šæ¯                                         â”‚           â”‚
â”‚  â”‚  â€¢ conversationHistory: å‰ç«¯ç¶­è­· (æœ€å¤š 10 æ¢)                â”‚           â”‚
â”‚  â”‚  â€¢ useMultiAgent: true (é è¨­)                                â”‚           â”‚
â”‚  â”‚  â€¢ (ä¸å‚³ isFirstResponseï¼Œç”± chat.js åˆ¤æ–·)                   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ å›è¦†è™•ç†                                                     â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  1. formatMessage() - Markdown â†’ HTML                        â”‚           â”‚
â”‚  â”‚  2. addMessage() - é¡¯ç¤ºåœ¨èŠå¤©çª—å£                            â”‚           â”‚
â”‚  â”‚  3. æ›´æ–° conversationHistory                                 â”‚           â”‚
â”‚  â”‚  4. trimConversationHistory() - ä¿æŒæœ€å¤š 10 æ¢               â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  Session çµæŸ (10åˆ†é˜é–’ç½® æˆ– ç”¨æˆ¶ä¸»å‹•)                                        â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ è©•åˆ†ç•Œé¢                                                     â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  â€¢ æ˜Ÿç´šè©•åˆ† (1-5)                                            â”‚           â”‚
â”‚  â”‚  â€¢ submitRating() â†’ endSession (Wix API)                     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 å…©ç«¯å·®ç•°å°æ¯”è¡¨

| ç‰¹æ€§ | Meta ç«¯ | ç¶²é ç«¯ |
|------|--------|-------|
| **é¦–æ¬¡åˆ¤æ–·** | ç•¶å¤©ç¬¬ä¸€æ¬¡ (è·¨ session) | Session ç¬¬ä¸€æ¬¡ |
| **å°è©±å„²å­˜** | Wix CMS æŒä¹…åŒ– | å‰ç«¯ session è¨˜æ†¶é«” |
| **æš«åœæ©Ÿåˆ¶** | 30 åˆ†é˜ (ç­‰å¾…çœŸäºº) | ç„¡ |
| **è¨Šæ¯æ ¼å¼** | ç´”æ–‡å­— | HTML (æ”¯æ´ Markdown) |
| **é–’ç½®è¨ˆæ™‚** | ç„¡ | 10 åˆ†é˜è‡ªå‹•çµæŸ |
| **è©•åˆ†æ©Ÿåˆ¶** | ç„¡ | 5 æ˜Ÿè©•åˆ† |
| **å»é‡æ©Ÿåˆ¶** | messageId å¿«å– | ç„¡ (å‰ç«¯åŒæ­¥) |
| **æ­·å²ä¾†æº** | Wix CMS æŸ¥è©¢ | å‰ç«¯é™£åˆ— |

---

## 3. RAG Pipeline å®Œæ•´æµç¨‹ (æ ¸å¿ƒ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RAG Pipeline å®Œæ•´æµç¨‹ (chat.js â†’ rag-pipeline.js)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  /api/chat æ¥æ”¶è«‹æ±‚                                                          â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ processWithRAG(message, history, productContext, options)   â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  options.useMultiAgent = true (é è¨­å•Ÿç”¨ Multi-Agent)        â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚  Step 1: AI æ„åœ–åˆ†æ (AI å„ªå…ˆ)                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ analyzeUserQuery() - api/analyze.js                         â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  è¼‰å…¥çŸ¥è­˜åº«:                                                  â”‚           â”‚
â”‚  â”‚  â”œâ”€ vehicle-specs.json (è»Šå‹èªè­‰)                            â”‚           â”‚
â”‚  â”‚  â”œâ”€ additive-guide.json (ç—‡ç‹€å°ç…§)                           â”‚           â”‚
â”‚  â”‚  â”œâ”€ search-reference.json (æœå°‹åƒè€ƒ)                         â”‚           â”‚
â”‚  â”‚  â””â”€ ai-analysis-rules.json (åˆ†æè¦å‰‡)                        â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  AI åˆ†æå…§å®¹:                                                 â”‚           â”‚
â”‚  â”‚  â”œâ”€ æ„åœ–é¡å‹è­˜åˆ¥                                             â”‚           â”‚
â”‚  â”‚  â”œâ”€ è»Šå‹/å¹´ä»½/ç‡ƒæ²¹æ¨è«–                                       â”‚           â”‚
â”‚  â”‚  â”œâ”€ èªè­‰æ¨è«– (å¹´ä»½ç‰¹å®šè¦å‰‡)                                  â”‚           â”‚
â”‚  â”‚  â”œâ”€ ç—‡ç‹€åŒ¹é…                                                 â”‚           â”‚
â”‚  â”‚  â”œâ”€ å°è©±æ­·å²ç¹¼æ‰¿                                             â”‚           â”‚
â”‚  â”‚  â””â”€ ç”Ÿæˆ wixQueries                                          â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  è¼¸å‡º: aiAnalysis ç‰©ä»¶                                        â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â”œâ”€â”€â”€ æˆåŠŸä¸”æœ‰æ•ˆ â”€â”€â†’ convertAIResultToIntent()                       â”‚
â”‚         â”‚                       â”‚                                           â”‚
â”‚         â”‚                       â–¼                                           â”‚
â”‚         â”‚                  enhanceIntentWithRules() (è¦å‰‡è£œå¼·)              â”‚
â”‚         â”‚                       â”‚                                           â”‚
â”‚         â”‚                       â–¼                                           â”‚
â”‚         â”‚                  usedAI = true                                    â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â””â”€â”€â”€ å¤±æ•—æˆ–ç„¡æ•ˆ â”€â”€â†’ classifyIntent() (è¦å‰‡åˆ†é¡å‚™æ´)                  â”‚
â”‚                                 â”‚                                           â”‚
â”‚                                 â–¼                                           â”‚
â”‚                            usedAI = false                                   â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚  Step 2: çŸ¥è­˜æª¢ç´¢                                                            â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ retrieveKnowledge(intent) - lib/knowledge-retriever.js      â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  æ°¸é è¼‰å…¥:                                                    â”‚           â”‚
â”‚  â”‚  â”œâ”€ core-identity.json (æ ¸å¿ƒèº«ä»½)                            â”‚           â”‚
â”‚  â”‚  â”œâ”€ ai-analysis-rules.json (åˆ†æè¦å‰‡)                        â”‚           â”‚
â”‚  â”‚  â”œâ”€ urls.json (çµ±ä¸€ URL)                                     â”‚           â”‚
â”‚  â”‚  â””â”€ anti-hallucination-rules.json (é˜²å¹»è¦º)                   â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  æŒ‰éœ€è¼‰å…¥:                                                    â”‚           â”‚
â”‚  â”‚  â”œâ”€ vehicleSpec (éœ€è¦è¦æ ¼ä¸”æœ‰å“ç‰Œæ™‚)                         â”‚           â”‚
â”‚  â”‚  â”œâ”€ certification (æ©Ÿæ²¹é¡åˆ¥æ™‚)                               â”‚           â”‚
â”‚  â”‚  â”œâ”€ jasoCert (æ‘©æ‰˜è»Šæ™‚)                                      â”‚           â”‚
â”‚  â”‚  â”œâ”€ symptoms (æ·»åŠ åŠ‘é¡åˆ¥æ™‚)                                  â”‚           â”‚
â”‚  â”‚  â”œâ”€ templates (æ ¹æ“š needsTemplates)                          â”‚           â”‚
â”‚  â”‚  â”œâ”€ specialScenario (ç‰¹æ®Šæƒ…å¢ƒæ™‚)                             â”‚           â”‚
â”‚  â”‚  â””â”€ categorySpec (éæ©Ÿæ²¹é¡åˆ¥æ™‚)                              â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚  Step 3: ç”¢å“æœå°‹ (P0 å„ªåŒ–)                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ æœå°‹è§¸ç™¼æ¢ä»¶åˆ¤æ–·                                             â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  è·³éæœå°‹:                                                    â”‚           â”‚
â”‚  â”‚  â”œâ”€ needsProductRecommendation = false                       â”‚           â”‚
â”‚  â”‚  â”œâ”€ needsTemplates ä¸å« product_recommendation               â”‚           â”‚
â”‚  â”‚  â””â”€ productContext å·²å‚³å…¥ä¸” > 100 å­—å…ƒ                       â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  åŸ·è¡Œæœå°‹:                                                    â”‚           â”‚
â”‚  â”‚  â””â”€ å…¶ä»–æƒ…æ³                                                 â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â”œâ”€â”€â”€ è·³é â”€â”€â†’ æª¢æŸ¥ recommendedSKU (å“ç‰Œå°ˆç”¨)                         â”‚
â”‚         â”‚             æª¢æŸ¥ additiveGuideMatch (ç—‡ç‹€è§£æ±º)                     â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â””â”€â”€â”€ åŸ·è¡Œ â”€â”€â†’ searchProducts() (ç›´æ¥å‡½å¼å‘¼å«)                        â”‚
â”‚                           â”‚                                                 â”‚
â”‚                           â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ searchProducts() - api/search.js                            â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  æœå°‹å„ªå…ˆé †åº:                                                â”‚           â”‚
â”‚  â”‚  0. èªè­‰æœå°‹ (certificationSearch)                           â”‚           â”‚
â”‚  â”‚  0.5 æ‘©æ‰˜è»Šæ©Ÿæ²¹æœå°‹ (é€Ÿå…‹é”/æª”è»Šç‰¹æ®Šè™•ç†)                    â”‚           â”‚
â”‚  â”‚  1. Wix Queries åŸ·è¡Œ                                         â”‚           â”‚
â”‚  â”‚  2. Fallback æœå°‹ (SKU â†’ é»åº¦ â†’ å…¨æ¬„ä½)                      â”‚           â”‚
â”‚  â”‚  3. Title Expansion (åŒæ¨™é¡Œå…¶ä»–å®¹é‡)                         â”‚           â”‚
â”‚  â”‚  4. å¤šè»Šå‹è™•ç† (æ±½è»Š vs æ‘©æ‰˜è»Šåˆ†é›¢)                          â”‚           â”‚
â”‚  â”‚  5. æ‘©æ‰˜è»Šéæ¿¾                                               â”‚           â”‚
â”‚  â”‚  6. SKU å„ªå…ˆæ’åº                                             â”‚           â”‚
â”‚  â”‚  7. å…¨åˆæˆå„ªå…ˆæ’åº                                           â”‚           â”‚
â”‚  â”‚  8. ç¶œåˆæ’åº                                                 â”‚           â”‚
â”‚  â”‚  9. æ·»åŠ åŠ‘å„ªå…ˆæ’åº                                           â”‚           â”‚
â”‚  â”‚  10. Fallback æ¨£æœ¬                                           â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚  Step 4: Prompt å»ºæ§‹ (Multi-Agent)                                          â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ buildPrompt(knowledge, intent, productContext, options)     â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  useMultiAgent = true:                                       â”‚           â”‚
â”‚  â”‚  â”œâ”€ selectAgent(intent) - é¸æ“‡ Agent é¡å‹                    â”‚           â”‚
â”‚  â”‚  â”‚   â”œâ”€ cooperation_inquiry â†’ COOPERATION (~250 tokens)     â”‚           â”‚
â”‚  â”‚  â”‚   â”œâ”€ purchase_inquiry â†’ PURCHASE (~300 tokens)           â”‚           â”‚
â”‚  â”‚  â”‚   â”œâ”€ price_inquiry â†’ PRICE (~300 tokens)                 â”‚           â”‚
â”‚  â”‚  â”‚   â”œâ”€ greeting (ç„¡è»Šå‹) â†’ GREETING (~200 tokens)          â”‚           â”‚
â”‚  â”‚  â”‚   â”œâ”€ æ·»åŠ åŠ‘æ¨è–¦ â†’ ADDITIVE (~500 tokens)                 â”‚           â”‚
â”‚  â”‚  â”‚   â”œâ”€ æ©Ÿæ²¹æ¨è–¦ â†’ OIL (~600 tokens)                        â”‚           â”‚
â”‚  â”‚  â”‚   â””â”€ å…¶ä»– â†’ GENERAL (~400 tokens)                        â”‚           â”‚
â”‚  â”‚  â””â”€ buildAgentPrompt() - å»ºæ§‹å°ˆç”¨ Prompt                     â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  useMultiAgent = false (Legacy):                             â”‚           â”‚
â”‚  â”‚  â””â”€ buildFullPrompt() - å®Œæ•´ Prompt (~2000-6000 tokens)     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  è¿”å› { intent, knowledge, systemPrompt, aiAnalysis, usedAI, agentType }   â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚  Step 5: Gemini API å‘¼å«                                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ callGemini(apiKey, contents)                                â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  â€¢ temperature: 0.1 (ä½éš¨æ©Ÿæ€§)                               â”‚           â”‚
â”‚  â”‚  â€¢ maxOutputTokens: 4096                                     â”‚           â”‚
â”‚  â”‚  â€¢ æ¸…é™¤ Cyrillic å­—ç¬¦ (ä¿„æ–‡)                                 â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚  Step 6: é˜²å¹»è¦ºé©—è­‰                                                          â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ validateAIResponse() - lib/response-validator.js            â”‚           â”‚
â”‚  â”‚                                                              â”‚           â”‚
â”‚  â”‚  â€¢ åªåœ¨ needsProductRecommendation æ™‚åŸ·è¡Œ                    â”‚           â”‚
â”‚  â”‚  â€¢ æª¢æŸ¥ AI å›è¦†ä¸­çš„ SKU æ˜¯å¦å­˜åœ¨æ–¼ç”¢å“åˆ—è¡¨                   â”‚           â”‚
â”‚  â”‚  â€¢ ç§»é™¤ç„¡æ•ˆçš„ SKU                                            â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  è¿”å› AI å›è¦†çµ¦ç”¨æˆ¶                                                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. çŸ¥è­˜åº«æŒ‰éœ€è¼‰å…¥å°ç…§è¡¨

### 4.1 çŸ¥è­˜åº«æª”æ¡ˆèˆ‡è¼‰å…¥æ™‚æ©Ÿ

| æª”æ¡ˆ | è¼‰å…¥æ™‚æ©Ÿ | è¼‰å…¥ä½ç½® | ç”¨é€” |
|------|---------|---------|------|
| `core-identity.json` | æ°¸é  | knowledge-retriever | å“ç‰Œèº«ä»½ã€è¦å‰‡ |
| `ai-analysis-rules.json` | æ°¸é  | knowledge-retriever, analyze | åˆ†æè¦å‰‡ã€ç¹¼æ‰¿è¦å‰‡ |
| `urls.json` | æ°¸é  | knowledge-retriever | çµ±ä¸€ URL |
| `anti-hallucination-rules.json` | æ°¸é  | knowledge-retriever | é˜²å¹»è¦ºè¦å‰‡ |
| `vehicle-specs.json` | æŒ‰éœ€ | analyze, knowledge-retriever | è»Šå‹èªè­‰å°ç…§ |
| `additive-guide.json` | æŒ‰éœ€ | analyze, knowledge-retriever | ç—‡ç‹€è§£æ±ºæ–¹æ¡ˆ |
| `search-reference.json` | æŒ‰éœ€ | analyze, rag-pipeline | æœå°‹åƒè€ƒã€èªè­‰å…¼å®¹ |
| `category-specs.json` | æŒ‰éœ€ | knowledge-retriever | éæ©Ÿæ²¹é¡åˆ¥è¦æ ¼ |
| `response-templates.json` | æŒ‰éœ€ | knowledge-retriever | å›è¦†ç¯„æœ¬ |
| `intent-keywords.json` | æŒ‰éœ€ | intent-classifier, intent-converter | æ„åœ–é—œéµå­— |
| `certification-rules.json` | æŒ‰éœ€ | certification-matcher | èªè­‰æ¨è«–è¦å‰‡ |
| `motorcycle-rules.json` | æŒ‰éœ€ | motorcycle-rules | JASO è¦å‰‡ |
| `conversation-memory.json` | æŒ‰éœ€ | prompt-builder | ç¹¼æ‰¿å„ªå…ˆç´š |

### 4.2 Agent é¡å‹èˆ‡è¼‰å…¥çŸ¥è­˜å°ç…§

| Agent é¡å‹ | è¼‰å…¥çš„çŸ¥è­˜ | Token é ä¼° |
|-----------|-----------|-----------|
| GREETING | èªè¨€è¦å‰‡ã€æ ¸å¿ƒèº«ä»½ | ~200 |
| COOPERATION | èªè¨€è¦å‰‡ã€æ ¸å¿ƒèº«ä»½ã€åˆä½œè¡¨å–® URL | ~250 |
| PURCHASE | èªè¨€è¦å‰‡ã€æ ¸å¿ƒèº«ä»½ã€storefinder èªªæ˜ | ~300 |
| PRICE | èªè¨€è¦å‰‡ã€æ ¸å¿ƒèº«ä»½ã€ç”¢å“è³‡æ–™ | ~300 |
| PRODUCT_ADDITIVE | èªè¨€è¦å‰‡ã€æ ¸å¿ƒèº«ä»½ã€ç—‡ç‹€åŒ¹é…ã€ç”¢å“ | ~500 |
| PRODUCT_OIL | èªè¨€è¦å‰‡ã€æ ¸å¿ƒèº«ä»½ã€è»Šå‹è³‡è¨Šã€èªè­‰ã€ç”¢å“ | ~600 |
| GENERAL | èªè¨€è¦å‰‡ã€æ ¸å¿ƒèº«ä»½ã€è»Šå‹è³‡è¨Šã€ç”¢å“ | ~400 |

---

## 5. æµç¨‹å„ªåŒ–ç¢ºèª - ç„¡é‡è¤‡ç„¡éºæ¼

### 5.1 å·²å„ªåŒ–é …ç›® âœ…

| å„ªåŒ–é …ç›® | å¯¦ç¾æ–¹å¼ | æ•ˆæœ |
|---------|---------|------|
| **çŸ¥è­˜åº«å¿«å–** | knowledge-cache.js æ¨¡çµ„ç´šå¿«å– | åŒé€²ç¨‹åªè¼‰å…¥ä¸€æ¬¡ |
| **ç”¢å“å¿«å–** | search.js 60 ç§’ TTL å¿«å– | æ¸›å°‘ CMS æŸ¥è©¢ |
| **ç›´æ¥å‡½å¼å‘¼å«** | P0 å„ªåŒ–ï¼Œé¿å…å…§éƒ¨ HTTP | é™ä½å»¶é² |
| **å°è©±æ­·å²é™åˆ¶** | æœ€å¤š 10 æ¢ | æ§åˆ¶ token |
| **Multi-Agent** | æŒ‰æ„åœ–é¸æ“‡ç²¾ç°¡ Prompt | ç¯€çœ 66-90% token |
| **æ¢ä»¶åŸ·è¡Œé©—è­‰** | åªåœ¨éœ€è¦æ¨è–¦æ™‚é©—è­‰ | æ¸›å°‘ä¸å¿…è¦è™•ç† |
| **æœå°‹æ¢ä»¶åˆ¤æ–·** | ä¸éœ€æ¨è–¦æ™‚è·³éæœå°‹ | æ¸›å°‘ä¸å¿…è¦æŸ¥è©¢ |

### 5.2 ç„¡é‡è¤‡å‘¼å«ç¢ºèª

```
æ¯å€‹è«‹æ±‚çš„æ¨¡çµ„å‘¼å«æ¬¡æ•¸:

loadJSON()           â†’ 6+ æ¬¡ï¼Œä½†å¿«å–å‘½ä¸­ âœ…
analyzeUserQuery()   â†’ 1 æ¬¡ âœ…
classifyIntent()     â†’ 0-1 æ¬¡ (åªåœ¨ AI å¤±æ•—æ™‚) âœ…
retrieveKnowledge()  â†’ 1 æ¬¡ âœ…
searchProducts()     â†’ 0-1 æ¬¡ (æ¢ä»¶åŸ·è¡Œ) âœ…
buildPrompt()        â†’ 1 æ¬¡ âœ…
callGemini()         â†’ 1 æ¬¡ âœ…
validateAIResponse() â†’ 0-1 æ¬¡ (æ¢ä»¶åŸ·è¡Œ) âœ…
```

### 5.3 æµç¨‹ç„¡éºæ¼ç¢ºèª

```
æ„åœ–é¡å‹è¦†è“‹:
â”œâ”€ product_recommendation â†’ PRODUCT_OIL / PRODUCT_ADDITIVE âœ…
â”œâ”€ general_inquiry        â†’ GREETING / GENERAL âœ…
â”œâ”€ cooperation_inquiry    â†’ COOPERATION âœ…
â”œâ”€ purchase_inquiry       â†’ PURCHASE âœ…
â”œâ”€ price_inquiry          â†’ PRICE âœ…
â””â”€ authentication         â†’ GENERAL (è¦å‰‡å¢å¼·) âœ…

ç”¢å“é¡åˆ¥è¦†è“‹:
â”œâ”€ æ©Ÿæ²¹      â†’ PRODUCT_OIL âœ…
â”œâ”€ æ·»åŠ åŠ‘    â†’ PRODUCT_ADDITIVE âœ…
â”œâ”€ è®Šé€Ÿç®±æ²¹  â†’ GENERAL + categorySpec âœ…
â”œâ”€ ç…è»Šç³»çµ±  â†’ GENERAL + categorySpec âœ…
â”œâ”€ å†·å»ç³»çµ±  â†’ GENERAL + categorySpec âœ…
â”œâ”€ é¦™æ°›      â†’ GENERAL + categorySpec âœ…
â””â”€ è‡ªè¡Œè»Š    â†’ GENERAL + categorySpec âœ…

ç‰¹æ®Šæƒ…å¢ƒè¦†è“‹:
â”œâ”€ ç´”é›»æ©Ÿè»Š (Gogoro)  â†’ specialScenario âœ…
â”œâ”€ ç´”é›»æ±½è»Š (Tesla)   â†’ specialScenario âœ…
â”œâ”€ æ²¹é›»æ··åˆ          â†’ specialScenario âœ…
â”œâ”€ Harley-Davidson   â†’ specialScenario âœ…
â””â”€ é«˜é‡Œç¨‹è»Š          â†’ specialScenario âœ…
```

---

## 6. Multi-Agent æ¶æ§‹èªªæ˜

### 6.1 Agent è·¯ç”±é‚è¼¯

```javascript
// agent-prompts.js - selectAgent()

function selectAgent(intent) {
    // 1. åˆä½œæ´½è©¢ (æœ€é«˜å„ªå…ˆ)
    if (type === 'cooperation_inquiry') return COOPERATION;

    // 2. è³¼è²·åœ°é»æŸ¥è©¢
    if (type === 'purchase_inquiry') return PURCHASE;

    // 3. åƒ¹æ ¼æŸ¥è©¢
    if (type === 'price_inquiry') return PRICE;

    // 4. ä¸€èˆ¬å•å€™ (ç„¡è»Šå‹ã€ç„¡éœ€æ±‚)
    if (type === 'general_inquiry' && !hasVehicleInfo && !needsProductRecommendation) {
        return GREETING;
    }

    // 5. ç”¢å“æ¨è–¦
    if (needsProductRecommendation) {
        if (productCategory === 'æ·»åŠ åŠ‘') return PRODUCT_ADDITIVE;
        return PRODUCT_OIL;
    }

    // 6. é è¨­
    return GENERAL;
}
```

### 6.2 Token ç¯€çœæ•ˆæœ

```
åŸæœ‰ Legacy æ¨¡å¼:
â”œâ”€ å®Œæ•´è¼‰å…¥æ‰€æœ‰è¦å‰‡
â”œâ”€ Prompt é•·åº¦: ~2000-6000 tokens
â””â”€ æ¯æ¬¡å‘¼å«æˆæœ¬è¼ƒé«˜

Multi-Agent æ¨¡å¼:
â”œâ”€ åªè¼‰å…¥è©²æ„åœ–éœ€è¦çš„è¦å‰‡
â”œâ”€ Prompt é•·åº¦: ~200-600 tokens
â”œâ”€ ç¯€çœ: 66-90%
â””â”€ æŒ‡ä»¤éµå¾ªåº¦æå‡ (å°ˆæ³¨å–®ä¸€ä»»å‹™)
```

---

## 7. å›é€€æ©Ÿåˆ¶èªªæ˜

### 7.1 API å›é€€

```
useMultiAgent = true (é è¨­)
    â”‚
    â””â”€ è‹¥éœ€è¦å®Œæ•´è¦å‰‡ â†’ useMultiAgent = false
        â”‚
        â””â”€ buildFullPrompt() å®Œæ•´ Prompt
```

### 7.2 AI åˆ†æå›é€€

```
Gemini AI åˆ†æ
    â”‚
    â”œâ”€ æˆåŠŸä¸”æœ‰æ•ˆ â†’ ä½¿ç”¨ AI çµæœ
    â”‚
    â””â”€ å¤±æ•—æˆ–ç„¡æ•ˆ â†’ classifyIntent() è¦å‰‡åˆ†é¡
                      â”‚
                      â””â”€ enhanceIntentWithRules() è¦å‰‡å¢å¼·
```

### 7.3 æœå°‹å›é€€

```
Wix Queries æœå°‹
    â”‚
    â”œâ”€ æœ‰çµæœ â†’ è¿”å›
    â”‚
    â””â”€ ç„¡çµæœ â†’ Fallback æœå°‹
                  â”‚
                  â”œâ”€ SKU ç²¾ç¢ºåŒ¹é…
                  â”œâ”€ é»åº¦å„ªå…ˆæœå°‹
                  â””â”€ å…¨æ¬„ä½æœå°‹
                      â”‚
                      â””â”€ ä»ç„¡çµæœ â†’ Fallback æ¨£æœ¬
```

---

## 8. ç¸½çµ

### æ¶æ§‹ç¢ºèª

| å•é¡Œ | ç­”æ¡ˆ |
|------|------|
| æ˜¯å¦ç‚º RAG æ¶æ§‹ï¼Ÿ | âœ… æ˜¯ï¼Œå®Œæ•´å¯¦ç¾ Retrieval + Augmentation + Generation |
| LLM + çŸ¥è­˜åº«æ··åˆï¼Ÿ | âœ… æ˜¯ï¼ŒçŸ¥è­˜åº«æ¥åœ° + LLM æ¨ç† + è¦å‰‡å‚™æ´ |
| Multi-Agent å®Œæ•´ï¼Ÿ | âœ… æ˜¯ï¼Œ7 ç¨® Agent è¦†è“‹æ‰€æœ‰æ„åœ– |
| ç„¡é‡è¤‡å‘¼å«ï¼Ÿ | âœ… æ˜¯ï¼Œå¿«å– + æ¢ä»¶åŸ·è¡Œ |
| ç„¡éºæ¼æµç¨‹ï¼Ÿ | âœ… æ˜¯ï¼Œæ‰€æœ‰æ„åœ–/é¡åˆ¥/æƒ…å¢ƒéƒ½æœ‰å°æ‡‰ |
| å‘å¾Œå…¼å®¹ï¼Ÿ | âœ… æ˜¯ï¼ŒuseMultiAgent=false å¯å›é€€ |
